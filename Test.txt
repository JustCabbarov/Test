using System;
using System.Threading.Tasks;

public class Program
{
    static int counter = 0; // Shared state (problem!)

    public static async Task Main()
    {
        var tasks = new Task[1000];

        for (int i = 0; i < 1000; i++)
        {
            tasks[i] = Task.Run(() =>
            {
                for (int j = 0; j < 1000; j++)
                {
                    counter++; // ❗ Race condition: çox riskli
                }
            });
        }

        await Task.WhenAll(tasks);

        Console.WriteLine($"Expected: 1,000,000 — Actual: {counter}");
    }
}
using System;
using System.Data.SqlClient;
using System.Threading.Tasks;

public class UserService
{
    private static string connectionString = "Server=localhost;Database=AppDb;User Id=sa;Password=123456;";

    public async Task<bool> LoginAsync(string username, string password)
    {
        
        string query = $"SELECT COUNT(*) FROM Users WHERE Username = '{username}' AND Password = '{password}'";

        SqlConnection connection = new SqlConnection(connectionString);
        SqlCommand command = new SqlCommand(query, connection);

        await connection.OpenAsync(); // ❗ Try/Catch yoxdur

        // ❗ Null istisna və ya int parse problemi ola bilər
        int count = (int)await command.ExecuteScalarAsync();

        if (count > 0)
        {
            Console.WriteLine("Login successful");

     }

        Console.WriteLine("Login failed");
        return false;
    }

    public async Task PrintUserEmailAsync(int userId)
    {
        string query = $"SELECT Email FROM Users WHERE Id = {userId}"; 

        var connection = new SqlConnection(connectionString);
        var command = new SqlCommand(query, connection);

        await connection.OpenAsync();

        // ❗ Null gəlsə crash edir
        string email = (string)await command.ExecuteScalarAsync(); 

        // ❗ Email format yoxlanılmır
        Console.WriteLine("User email: " + email.ToLower());
    }
}


